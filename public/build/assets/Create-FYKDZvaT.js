import{r as y,T as B,y as A,c as N,w as v,o as d,a as e,b as n,f as h,u as l,i as D,p as I,j as w,v as k,d as u,g as S,F as $,t as r,e as p,n as j}from"./app-Bbm6nPfF.js";import{_ as H}from"./AppLayout-BVLftzrV.js";import{_ as f}from"./InputLabel-BnPyyqhe.js";import{_ as E}from"./TextInput-3LTJMV0m.js";import{_ as g}from"./InputError-BwEQXkyc.js";import{_ as L}from"./PrimaryButton-C4b6_sBe.js";import{_ as q}from"./SecondaryButton-lqUrONvz.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const X={class:"flex justify-between items-center"},O={class:"py-12"},R={class:"max-w-3xl mx-auto sm:px-6 lg:px-8"},T={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg"},G={class:"p-6"},W={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Y={class:"md:col-span-2"},J=["value"],K={key:0,class:"mt-2 p-3 bg-blue-50 rounded-lg"},Q={class:"text-sm"},Z={class:"font-medium text-blue-900"},ee={class:"text-blue-700"},se={class:"flex justify-between mt-2"},te={class:"md:col-span-2"},le=["value"],oe={key:0,class:"mt-2 p-3 bg-green-50 rounded-lg"},re={class:"text-sm"},ie={class:"font-medium text-green-900"},ne={class:"text-green-700"},ae={class:"flex justify-between mt-2"},de={class:"mt-1 relative rounded-md shadow-sm"},ue={class:"mt-1 relative rounded-md shadow-sm"},ce={key:0,class:"mt-6 p-4 bg-gray-50 rounded-lg"},me={class:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm"},pe={class:"text-lg font-bold text-green-600"},ve={key:0},fe={class:"text-lg font-bold text-purple-600"},ge={key:1,class:"mt-6 p-4 bg-blue-50 rounded-lg"},xe={class:"flex items-center justify-between"},_e={class:"text-right"},be={class:"text-sm font-medium text-blue-900"},ye={class:"text-xs text-blue-700"},he={key:2,class:"mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg"},we={class:"flex items-center justify-end mt-6 space-x-3"},ke={key:0,class:"animate-spin -ml-1 mr-3 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Fe={__name:"Create",props:{elements:Array,suppliers:Array,preselectedElement:Object,preselectedSupplier:Object},setup(_){var M,V;const m=_,a=y(null),c=y(null),x=y(!1),t=B({element_id:((M=m.preselectedElement)==null?void 0:M.id)||"",supplier_id:((V=m.preselectedSupplier)==null?void 0:V.id)||"",purchase_price:"",selling_price:"",currency:"MXN"});m.preselectedElement&&(a.value=m.preselectedElement),m.preselectedSupplier&&(c.value=m.preselectedSupplier);const C=()=>{const o=parseFloat(t.purchase_price),s=parseFloat(t.selling_price);return!o||!s?0:(s-o)/o*100},P=()=>{const o=C();return o>=30?"text-green-600":o>=15?"text-blue-600":o>=5?"text-yellow-600":"text-red-600"},F=()=>{const o=parseInt(t.element_id);a.value=m.elements.find(s=>s.id===o)||null,b()},U=()=>{const o=parseInt(t.supplier_id);c.value=m.suppliers.find(s=>s.id===o)||null,b()},b=()=>{if(!t.element_id||!t.supplier_id){x.value=!1;return}fetch(`/api/inventory/check-price-duplicate?element_id=${t.element_id}&supplier_id=${t.supplier_id}`).then(o=>o.json()).then(o=>{x.value=o.exists||!1}).catch(o=>{console.error("Error checking for duplicates:",o),x.value=!1})};A([()=>t.element_id,()=>t.supplier_id],()=>{b()});const z=()=>{t.post(route("element-prices.store"),{onSuccess:()=>{}})};return(o,s)=>(d(),N(H,{title:"Crear Precio"},{header:v(()=>[e("div",X,[s[7]||(s[7]=e("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"}," Asignar Precio a Elemento ",-1)),n(l(D),{href:o.route("element-prices.index"),class:"text-blue-600 hover:text-blue-800"},{default:v(()=>s[6]||(s[6]=[h(" ← Volver a la lista ")])),_:1},8,["href"])])]),default:v(()=>[e("div",O,[e("div",R,[e("div",T,[e("div",G,[e("form",{onSubmit:I(z,["prevent"])},[e("div",W,[e("div",Y,[n(f,{for:"element_id",value:"Elemento *"}),w(e("select",{id:"element_id","onUpdate:modelValue":s[0]||(s[0]=i=>l(t).element_id=i),onChange:F,class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",required:""},[s[8]||(s[8]=e("option",{value:""},"Seleccionar elemento",-1)),(d(!0),u($,null,S(_.elements,i=>(d(),u("option",{key:i.id,value:i.id},r(i.name)+" ("+r(i.category)+") ",9,J))),128))],544),[[k,l(t).element_id]]),n(g,{class:"mt-2",message:l(t).errors.element_id},null,8,["message"]),a.value?(d(),u("div",K,[e("div",Q,[e("div",Z,r(a.value.name),1),e("div",ee,r(a.value.description),1),e("div",se,[e("span",null,"Stock actual: "+r(a.value.current_stock)+" "+r(a.value.unit),1),e("span",null,"Categoría: "+r(a.value.category),1)])])])):p("",!0)]),e("div",te,[n(f,{for:"supplier_id",value:"Proveedor *"}),w(e("select",{id:"supplier_id","onUpdate:modelValue":s[1]||(s[1]=i=>l(t).supplier_id=i),onChange:U,class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",required:""},[s[9]||(s[9]=e("option",{value:""},"Seleccionar proveedor",-1)),(d(!0),u($,null,S(_.suppliers,i=>(d(),u("option",{key:i.id,value:i.id},r(i.name)+" ("+r(i.country)+") ",9,le))),128))],544),[[k,l(t).supplier_id]]),n(g,{class:"mt-2",message:l(t).errors.supplier_id},null,8,["message"]),c.value?(d(),u("div",oe,[e("div",re,[e("div",ie,r(c.value.name),1),e("div",ne,r(c.value.contact||"Sin contacto"),1),e("div",ae,[e("span",null,r(c.value.email||"Sin email"),1),e("span",null,r(c.value.country),1)])])])):p("",!0)]),e("div",null,[n(f,{for:"purchase_price",value:"Precio de Compra"}),e("div",de,[s[10]||(s[10]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("span",{class:"text-gray-500 sm:text-sm"},"$")],-1)),n(E,{id:"purchase_price",modelValue:l(t).purchase_price,"onUpdate:modelValue":s[2]||(s[2]=i=>l(t).purchase_price=i),type:"number",step:"0.01",min:"0",class:"pl-7 block w-full",placeholder:"0.00"},null,8,["modelValue"])]),n(g,{class:"mt-2",message:l(t).errors.purchase_price},null,8,["message"])]),e("div",null,[n(f,{for:"selling_price",value:"Precio de Venta"}),e("div",ue,[s[11]||(s[11]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("span",{class:"text-gray-500 sm:text-sm"},"$")],-1)),n(E,{id:"selling_price",modelValue:l(t).selling_price,"onUpdate:modelValue":s[3]||(s[3]=i=>l(t).selling_price=i),type:"number",step:"0.01",min:"0",class:"pl-7 block w-full",placeholder:"0.00"},null,8,["modelValue"])]),n(g,{class:"mt-2",message:l(t).errors.selling_price},null,8,["message"])]),e("div",null,[n(f,{for:"currency",value:"Moneda *"}),w(e("select",{id:"currency","onUpdate:modelValue":s[4]||(s[4]=i=>l(t).currency=i),class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",required:""},s[12]||(s[12]=[e("option",{value:"MXN"},"MXN - Peso Mexicano",-1),e("option",{value:"USD"},"USD - Dólar Americano",-1),e("option",{value:"EUR"},"EUR - Euro",-1)]),512),[[k,l(t).currency]]),n(g,{class:"mt-2",message:l(t).errors.currency},null,8,["message"])])]),l(t).purchase_price&&l(t).selling_price?(d(),u("div",ce,[s[16]||(s[16]=e("h4",{class:"text-sm font-medium text-gray-700 mb-3"},"Cálculos Automáticos:",-1)),e("div",me,[e("div",null,[s[13]||(s[13]=e("span",{class:"text-gray-600 font-medium"},"Margen:",-1)),e("div",{class:j(["text-lg font-bold",P()])},r(C().toFixed(2))+"% ",3)]),e("div",null,[s[14]||(s[14]=e("span",{class:"text-gray-600 font-medium"},"Ganancia por Unidad:",-1)),e("div",pe," $"+r((parseFloat(l(t).selling_price)-parseFloat(l(t).purchase_price)).toFixed(2)),1)]),a.value?(d(),u("div",ve,[s[15]||(s[15]=e("span",{class:"text-gray-600 font-medium"},"Valor del Stock:",-1)),e("div",fe," $"+r((a.value.current_stock*parseFloat(l(t).purchase_price)).toFixed(2)),1)])):p("",!0)])])):p("",!0),a.value&&c.value?(d(),u("div",ge,[s[18]||(s[18]=e("h4",{class:"text-sm font-medium text-blue-700 mb-3"},"Vista Previa:",-1)),e("div",xe,[s[17]||(s[17]=e("div",{class:"flex items-center space-x-4"},[e("div",{class:"text-center"},[e("div",{class:"w-12 h-12 bg-blue-500 rounded-lg flex items-center justify-center text-white font-bold"},[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})])]),e("div",{class:"text-xs text-blue-700 mt-1"},"Elemento")]),e("div",{class:"text-blue-600"},[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})])]),e("div",{class:"text-center"},[e("div",{class:"w-12 h-12 bg-green-500 rounded-lg flex items-center justify-center text-white font-bold"},[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})])]),e("div",{class:"text-xs text-green-700 mt-1"},"Proveedor")])],-1)),e("div",_e,[e("div",be,r(a.value.name)+" ← "+r(c.value.name),1),e("div",ye,r(l(t).currency)+" $"+r(l(t).purchase_price||"0.00")+" → $"+r(l(t).selling_price||"0.00"),1)])])])):p("",!0),x.value?(d(),u("div",he,s[19]||(s[19]=[e("div",{class:"flex"},[e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})])]),e("div",{class:"ml-3"},[e("h3",{class:"text-sm font-medium text-yellow-800"},"Atención"),e("div",{class:"mt-2 text-sm text-yellow-700"}," Ya existe un precio para este elemento con este proveedor. Si continúas, se creará una entrada adicional. ")])],-1)]))):p("",!0),s[23]||(s[23]=e("div",{class:"mt-6 p-4 bg-green-50 rounded-lg"},[e("h4",{class:"text-sm font-medium text-green-700 mb-2"},"💡 Consejos:"),e("ul",{class:"text-sm text-green-600 space-y-1"},[e("li",null,"• Un elemento puede tener múltiples proveedores con diferentes precios"),e("li",null,"• El margen se calcula automáticamente: (Precio Venta - Precio Compra) / Precio Compra"),e("li",null,"• Los precios de compra son utilizados para calcular el valor del inventario"),e("li",null,"• Los precios de venta son opcionales pero recomendados para análisis de márgenes")])],-1)),e("div",we,[n(q,{type:"button",onClick:s[5]||(s[5]=i=>o.$inertia.visit(o.route("element-prices.index")))},{default:v(()=>s[20]||(s[20]=[h(" Cancelar ")])),_:1}),n(L,{class:j({"opacity-25":l(t).processing}),disabled:l(t).processing},{default:v(()=>[l(t).processing?(d(),u("svg",ke,s[21]||(s[21]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):p("",!0),s[22]||(s[22]=h(" Crear Precio "))]),_:1},8,["class","disabled"])])],32)])])])])]),_:1}))}};export{Fe as default};
