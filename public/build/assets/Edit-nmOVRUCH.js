import{r as $,T,h as p,q as F,c as O,w as x,o as a,a as t,t as l,b as c,f as b,u as o,i as A,n as y,p as L,j as _,k as N,v as j,d as r,F as B,g as K,e as d}from"./app-Bbm6nPfF.js";import{_ as P}from"./AppLayout-BVLftzrV.js";import{_ as E}from"./InputLabel-BnPyyqhe.js";import{_ as Q}from"./TextInput-3LTJMV0m.js";import{_ as k}from"./InputError-BwEQXkyc.js";import{_ as G}from"./PrimaryButton-C4b6_sBe.js";import{_ as J}from"./SecondaryButton-lqUrONvz.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const W={class:"flex justify-between items-center"},X={class:"font-semibold text-xl text-gray-800 leading-tight"},Y={class:"flex space-x-2"},Z={class:"py-12"},ee={class:"max-w-4xl mx-auto sm:px-6 lg:px-8"},te={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg"},se={class:"p-6"},ne={class:"mb-6 p-4 bg-blue-50 rounded-lg"},ie={class:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm"},oe={class:"text-lg font-bold"},le={class:"text-lg font-bold"},ae={class:"text-lg font-bold text-green-600"},re={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8"},de={class:"md:col-span-2"},ue={class:"md:col-span-2"},ce={class:"mb-8"},me={key:0,class:"text-center py-8 text-gray-500"},ge={key:1,class:"space-y-3"},ve={class:"flex-1 grid grid-cols-1 md:grid-cols-3 gap-4"},fe={class:"md:col-span-2"},pe=["onUpdate:modelValue","onChange"],xe=["value"],be={key:0,class:"mt-1 text-sm text-gray-500"},ye={key:1,class:"mt-1 text-xs text-green-600 font-medium"},_e={key:2,class:"mt-1 text-xs text-orange-600 font-medium"},ke=["onUpdate:modelValue"],he={key:0,class:"mt-1 text-xs text-gray-500"},we={key:1,class:"mt-1 text-xs text-orange-600"},Ce={key:0,class:"text-right"},qe={class:"text-sm"},Ve={class:"text-xs text-gray-500"},De=["onClick"],Ee={key:0,class:"mb-8 p-4 bg-orange-50 rounded-lg"},Me={class:"space-y-2 text-sm"},$e={key:0,class:"text-orange-700"},Ae={key:1,class:"text-orange-700"},Ne={key:2,class:"text-orange-700"},je={key:3,class:"text-green-700"},Be={key:4,class:"text-orange-700"},Ke={key:5,class:"text-red-700"},ze={key:1,class:"mb-8 p-4 bg-blue-50 rounded-lg"},He={class:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm"},Se={class:"text-lg font-bold text-blue-900"},Ue={class:"text-lg font-bold text-blue-900"},Ie={key:0,class:"mt-3 text-sm text-red-600"},Re={class:"flex items-center justify-end space-x-3"},Te={key:0,class:"animate-spin -ml-1 mr-3 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Xe={__name:"Edit",props:{kit:Object,elements:Array},setup(u){const m=u,h=$(m.elements||[]),w=$([...m.kit.kit_components]),n=T({name:m.kit.name,description:m.kit.description||"",category:m.kit.category||"",components:m.kit.kit_components.map(s=>({id:s.id,element_id:s.element_id,quantity:s.quantity,element:s.element,original_quantity:s.quantity,is_new:!1}))}),M=p(()=>{const s=n.name!==m.kit.name||n.description!==(m.kit.description||"")||n.category!==(m.kit.category||""),e=C.value>0||q.value>0||V.value>0;return s||e}),C=p(()=>n.components.filter(s=>s.is_new).length),q=p(()=>n.components.filter(s=>!s.is_new&&(s.quantity!==s.original_quantity||!w.value.find(e=>e.id===s.id))).length),V=p(()=>{const s=n.components.filter(e=>!e.is_new).map(e=>e.id);return w.value.filter(e=>!s.includes(e.id)).length}),D=p(()=>n.components.every(s=>s.element&&s.quantity<=s.element.current_stock)),z=p(()=>n.components.reduce((s,e)=>{if(e.element&&e.element.prices&&e.element.prices.length>0){const v=e.element.prices.reduce((i,f)=>i+(f.purchase_price||0),0)/e.element.prices.length;return s+v*e.quantity}return s},0)),H=()=>{n.components.push({temp_id:Date.now(),element_id:"",quantity:1,element:null,is_new:!0})},S=s=>{n.components.splice(s,1)},U=s=>{const e=n.components[s].element_id,v=h.value.find(i=>i.id==e);n.components[s].element=v},I=(s,e)=>{if(s.is_new)return!1;const v=w.value.find(i=>i.id===s.id);return v?s.element_id!==v.element_id||s.quantity!==v.quantity:!0},R=()=>{const s={name:n.name,description:n.description,category:n.category,components:n.components.map(e=>({id:e.is_new?void 0:e.id,element_id:e.element_id,quantity:e.quantity}))};n.transform(e=>s).put(route("inventory-kits.update",m.kit.id),{onSuccess:()=>{}})};return F(()=>{m.elements||fetch("/api/inventory/elements/search").then(s=>s.json()).then(s=>{h.value=s}).catch(s=>{console.error("Error al cargar elementos:",s)})}),(s,e)=>(a(),O(P,{title:"Editar Kit"},{header:x(()=>[t("div",W,[t("h2",X," Editar Kit: "+l(u.kit.name),1),t("div",Y,[c(o(A),{href:s.route("inventory-kits.show",u.kit.id),class:"text-blue-600 hover:text-blue-800"},{default:x(()=>e[4]||(e[4]=[b(" Ver Detalles ")])),_:1},8,["href"]),c(o(A),{href:s.route("inventory-kits.index"),class:"text-blue-600 hover:text-blue-800"},{default:x(()=>e[5]||(e[5]=[b(" ← Volver a la lista ")])),_:1},8,["href"])])])]),default:x(()=>{var v;return[t("div",Z,[t("div",ee,[t("div",te,[t("div",se,[t("div",ne,[e[10]||(e[10]=t("h3",{class:"text-lg font-medium text-blue-900 mb-2"},"Estado Actual del Kit",-1)),t("div",ie,[t("div",null,[e[6]||(e[6]=t("span",{class:"text-blue-700 font-medium"},"Disponibilidad:",-1)),t("div",{class:y(["text-lg font-bold",u.kit.can_be_assembled?"text-green-600":"text-red-600"])},l(u.kit.can_be_assembled?"Disponible":"No Disponible"),3)]),t("div",null,[e[7]||(e[7]=t("span",{class:"text-blue-700 font-medium"},"Kits Posibles:",-1)),t("div",oe,l(u.kit.max_assemblies||0),1)]),t("div",null,[e[8]||(e[8]=t("span",{class:"text-blue-700 font-medium"},"Componentes:",-1)),t("div",le,l(u.kit.kit_components.length),1)]),t("div",null,[e[9]||(e[9]=t("span",{class:"text-blue-700 font-medium"},"Costo Total:",-1)),t("div",ae," $"+l(((v=u.kit.total_cost)==null?void 0:v.toFixed(2))||"0.00"),1)])])]),t("form",{onSubmit:L(R,["prevent"])},[t("div",re,[t("div",de,[c(E,{for:"name",value:"Nombre del Kit *"}),c(Q,{id:"name",modelValue:o(n).name,"onUpdate:modelValue":e[0]||(e[0]=i=>o(n).name=i),type:"text",class:"mt-1 block w-full",required:"",placeholder:"Ej: Kit de Resistencias Básicas"},null,8,["modelValue"]),c(k,{class:"mt-2",message:o(n).errors.name},null,8,["message"])]),t("div",ue,[c(E,{for:"description",value:"Descripción"}),_(t("textarea",{id:"description","onUpdate:modelValue":e[1]||(e[1]=i=>o(n).description=i),rows:"3",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",placeholder:"Descripción detallada del kit..."},null,512),[[N,o(n).description]]),c(k,{class:"mt-2",message:o(n).errors.description},null,8,["message"])]),t("div",null,[c(E,{for:"category",value:"Categoría"}),_(t("select",{id:"category","onUpdate:modelValue":e[2]||(e[2]=i=>o(n).category=i),class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50"},e[11]||(e[11]=[t("option",{value:""},"Seleccionar categoría",-1),t("option",{value:"Electrónicos"},"Electrónicos",-1),t("option",{value:"Mecánicos"},"Mecánicos",-1),t("option",{value:"Químicos"},"Químicos",-1),t("option",{value:"Herramientas"},"Herramientas",-1),t("option",{value:"Educativo"},"Educativo",-1),t("option",{value:"Reparación"},"Reparación",-1),t("option",{value:"Otros"},"Otros",-1)]),512),[[j,o(n).category]]),c(k,{class:"mt-2",message:o(n).errors.category},null,8,["message"])])]),t("div",ce,[t("div",{class:"flex justify-between items-center mb-4"},[e[13]||(e[13]=t("h3",{class:"text-lg font-medium text-gray-900"},"Componentes del Kit",-1)),t("button",{type:"button",onClick:H,class:"bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded inline-flex items-center"},e[12]||(e[12]=[t("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),b(" Agregar Componente ")]))]),o(n).components.length===0?(a(),r("div",me,e[14]||(e[14]=[t("svg",{class:"mx-auto h-12 w-12 text-gray-400 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})],-1),t("p",null,"No hay componentes en el kit",-1),t("p",{class:"text-sm"},'Haz clic en "Agregar Componente" para empezar',-1)]))):(a(),r("div",ge,[(a(!0),r(B,null,K(o(n).components,(i,f)=>(a(),r("div",{key:i.temp_id||i.id||f,class:y(["flex items-center space-x-4 p-4 rounded-lg",i.is_new?"bg-green-50 border border-green-200":"bg-gray-50"])},[t("div",ve,[t("div",fe,[_(t("select",{"onUpdate:modelValue":g=>i.element_id=g,onChange:g=>U(f),class:"w-full border-gray-300 rounded-md shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",required:""},[e[15]||(e[15]=t("option",{value:""},"Seleccionar elemento",-1)),(a(!0),r(B,null,K(h.value,g=>(a(),r("option",{key:g.id,value:g.id},l(g.name)+" ("+l(g.current_stock)+" "+l(g.unit)+" disponibles) ",9,xe))),128))],40,pe),[[j,i.element_id]]),i.element?(a(),r("div",be,l(i.element.category)+" - "+l(i.element.description),1)):d("",!0),i.is_new?(a(),r("div",ye," ✓ Nuevo componente ")):I(i,f)?(a(),r("div",_e," ⚠️ Componente modificado ")):d("",!0)]),t("div",null,[_(t("input",{"onUpdate:modelValue":g=>i.quantity=g,type:"number",min:"1",class:"w-full border-gray-300 rounded-md shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",placeholder:"Cantidad",required:""},null,8,ke),[[N,i.quantity,void 0,{number:!0}]]),i.element?(a(),r("div",he,l(i.element.unit),1)):d("",!0),!i.is_new&&i.original_quantity&&i.quantity!==i.original_quantity?(a(),r("div",we," Anterior: "+l(i.original_quantity),1)):d("",!0)])]),i.element?(a(),r("div",Ce,[t("div",qe,[t("span",{class:y([i.quantity<=i.element.current_stock?"text-green-600":"text-red-600","font-medium"])},l(i.quantity<=i.element.current_stock?"✓ Disponible":"✗ Insuficiente"),3)]),t("div",Ve," Stock: "+l(i.element.current_stock),1)])):d("",!0),t("button",{type:"button",onClick:g=>S(f),class:"text-red-600 hover:text-red-800"},e[16]||(e[16]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)]),8,De)],2))),128))])),c(k,{class:"mt-2",message:o(n).errors.components},null,8,["message"])]),M.value?(a(),r("div",Ee,[e[17]||(e[17]=t("h4",{class:"font-medium text-orange-900 mb-3"},"Resumen de Cambios",-1)),t("div",Me,[o(n).name!==u.kit.name?(a(),r("div",$e,' • Nombre: "'+l(u.kit.name)+'" → "'+l(o(n).name)+'" ',1)):d("",!0),o(n).description!==u.kit.description?(a(),r("div",Ae," • Descripción actualizada ")):d("",!0),o(n).category!==u.kit.category?(a(),r("div",Ne,' • Categoría: "'+l(u.kit.category)+'" → "'+l(o(n).category)+'" ',1)):d("",!0),C.value>0?(a(),r("div",je," • "+l(C.value)+" componente(s) agregado(s) ",1)):d("",!0),q.value>0?(a(),r("div",Be," • "+l(q.value)+" componente(s) modificado(s) ",1)):d("",!0),V.value>0?(a(),r("div",Ke," • "+l(V.value)+" componente(s) eliminado(s) ",1)):d("",!0)])])):d("",!0),o(n).components.length>0?(a(),r("div",ze,[e[21]||(e[21]=t("h4",{class:"font-medium text-blue-900 mb-3"},"Resumen del Kit Actualizado",-1)),t("div",He,[t("div",null,[e[18]||(e[18]=t("span",{class:"text-blue-700 font-medium"},"Total Componentes:",-1)),t("div",Se,l(o(n).components.length),1)]),t("div",null,[e[19]||(e[19]=t("span",{class:"text-blue-700 font-medium"},"Disponibilidad:",-1)),t("div",{class:y(["text-lg font-bold",D.value?"text-green-600":"text-red-600"])},l(D.value?"Disponible":"No Disponible"),3)]),t("div",null,[e[20]||(e[20]=t("span",{class:"text-blue-700 font-medium"},"Nuevo Costo:",-1)),t("div",Ue," $"+l(z.value.toFixed(2)),1)])]),D.value?d("",!0):(a(),r("div",Ie," ⚠️ Algunos componentes no tienen stock suficiente "))])):d("",!0),t("div",Re,[c(J,{type:"button",onClick:e[3]||(e[3]=i=>s.$inertia.visit(s.route("inventory-kits.show",u.kit.id)))},{default:x(()=>e[22]||(e[22]=[b(" Cancelar ")])),_:1}),c(G,{class:y({"opacity-25":o(n).processing}),disabled:o(n).processing||o(n).components.length===0||!M.value},{default:x(()=>[o(n).processing?(a(),r("svg",Te,e[23]||(e[23]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):d("",!0),e[24]||(e[24]=b(" Actualizar Kit "))]),_:1},8,["class","disabled"])])],32)])])])])]}),_:1}))}};export{Xe as default};
